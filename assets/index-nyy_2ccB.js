(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))L(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&L(i)}).observe(document,{childList:!0,subtree:!0});function l(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function L(n){if(n.ep)return;n.ep=!0;const o=l(n);fetch(n.href,o)}})();const t={playerSlots:[],enemySlots:[],maxSwaps:1,swapsLeft:0,battleStarted:!1,selectedSlots:[],animationInProgress:!1};let I,N,$,A,B,j,x,g,v,P,T,k,G,q,M,b;function z(){I=document.getElementById("player-slots"),N=document.getElementById("enemy-slots"),$=document.getElementById("swap-slots"),A=document.getElementById("swaps-left"),B=document.getElementById("battle-log-content"),j=document.getElementById("result-message"),x=document.getElementById("shuffle-btn"),g=document.getElementById("swap-btn"),v=document.getElementById("start-battle"),P=document.getElementById("reset-game"),T=document.getElementById("confirm-swap"),k=document.getElementById("cancel-swap"),G=document.getElementById("close-result"),q=document.getElementById("swap-modal"),M=document.getElementById("result-modal"),b=document.getElementById("battle-animation-container"),D(),Q()}function D(){x.addEventListener("click",K),g.addEventListener("click",()=>{t.selectedSlots=[],W(),q.classList.add("show"),T.disabled=!0}),T.addEventListener("click",U),k.addEventListener("click",()=>{q.classList.remove("show"),t.selectedSlots=[]}),v.addEventListener("click",V),P.addEventListener("click",Q),G.addEventListener("click",()=>{M.classList.remove("show"),P.disabled=!1,x.disabled=!0,g.disabled=!0,v.disabled=!0}),b.addEventListener("click",()=>{t.animationInProgress&&(O(),F())})}function Q(){t.playerSlots=[],t.enemySlots=[],t.swapsLeft=t.maxSwaps,t.battleStarted=!1,t.selectedSlots=[],t.animationInProgress=!1,A.textContent=t.swapsLeft.toString(),x.disabled=!1,g.disabled=!0,v.disabled=!0,B.innerHTML="",I.innerHTML="",N.innerHTML="",q.classList.remove("show"),M.classList.remove("show"),O()}function O(){b.classList.remove("show"),t.animationInProgress=!1}let S=[];function F(){if(S.length>0){const e=S.shift();e&&e()}}function H(){const e=["👊🏻","✌🏻","🖐🏻"],s=Math.floor(Math.random()*e.length);return e[s]}function K(){t.playerSlots=Array(4).fill(null).map(()=>H()),t.enemySlots=Array(4).fill(null).map(()=>H()),w(),g.disabled=t.swapsLeft<=0,v.disabled=!1}function w(){I.innerHTML="",t.playerSlots.forEach((e,s)=>{const l=document.createElement("div");l.className="slot player-slot",l.textContent=e,l.dataset.index=s.toString(),I.appendChild(l)}),N.innerHTML="",t.enemySlots.forEach((e,s)=>{const l=document.createElement("div");l.className="slot enemy-slot",l.textContent=e,l.dataset.index=s.toString(),N.appendChild(l)})}function W(){$.innerHTML="",t.playerSlots.forEach((e,s)=>{const l=document.createElement("div");l.className="slot swap-slot",l.textContent=e,l.dataset.index=s.toString(),t.selectedSlots.includes(s)&&l.classList.add("selected"),l.addEventListener("click",()=>J(s)),$.appendChild(l)})}function J(e){const s=t.selectedSlots.indexOf(e);s>-1?t.selectedSlots.splice(s,1):(t.selectedSlots.length<2||t.selectedSlots.shift(),t.selectedSlots.push(e)),W(),T.disabled=t.selectedSlots.length!==2}function U(){if(t.selectedSlots.length!==2)return;const[e,s]=t.selectedSlots,l=t.playerSlots[e];t.playerSlots[e]=t.playerSlots[s],t.playerSlots[s]=l,t.swapsLeft--,A.textContent=t.swapsLeft.toString(),w(),q.classList.remove("show"),t.selectedSlots=[],g.disabled=t.swapsLeft<=0}function V(){if(t.playerSlots.length===0||t.enemySlots.length===0)return;t.battleStarted=!0,x.disabled=!0,g.disabled=!0,v.disabled=!0;const e=[...t.playerSlots],s=[...t.enemySlots];a("战斗开始","round-header"),a(`我方: ${e.join(" ")}`,"log-entry"),a(`敌方: ${s.join(" ")}`,"log-entry"),X()}function a(e,s=""){const l=document.createElement("div");l.className=s,e.includes("====")&&l.classList.add("log-divider"),e.includes("我方胜利")?l.classList.add("win-result"):e.includes("敌方胜利")?l.classList.add("lose-result"):e.includes("平局")&&l.classList.add("draw-result"),e.includes("胜过了")?l.classList.add("win-result"):e.includes("输给了")?l.classList.add("lose-result"):e.includes("平手")&&l.classList.add("draw-result"),l.textContent=e,B.appendChild(l),B.scrollTop=B.scrollHeight}function X(){S=[];let e=[...t.playerSlots],s=[...t.enemySlots],l=1;for(a("==== 详细对战过程 ====","round-header");e.length>0&&s.length>0;){const n=l,o=e[0],i=s[0],y=[...e],m=[...s],c=()=>{a(`回合 ${n}`,"round-header");const f=R(o,i);Y(o,i,f,y,m),S.push(()=>{f==="win"?(a(`我方的 ${o} 胜过了敌方的 ${i}`,"log-entry"),e.forEach((C,h)=>{if(h===0){const p=I.querySelector(`.player-slot[data-index="${h}"]`);p&&(p.classList.add("win"),setTimeout(()=>p.classList.remove("win"),1e3))}}),s.shift(),w()):f==="lose"?(a(`我方的 ${o} 输给了敌方的 ${i}`,"log-entry"),e.shift(),w()):(a(`我方的 ${o} 和敌方的 ${i} 打成平手`,"log-entry"),e.shift(),s.shift(),w()),a(`我方剩余: ${e.join(" ")}`,"log-entry"),a(`敌方剩余: ${s.join(" ")}`,"log-entry"),a("------------------------","log-entry"),(e.length===0||s.length===0)&&L()})};S.push(c);const d=R(o,i);d==="win"?s.shift():d==="lose"?e.shift():(e.shift(),s.shift()),l++}function L(){let n="";e.length>0&&s.length===0?n="我方胜利！":e.length===0&&s.length>0?n="敌方胜利！":n="平局！",a("==== 最终结果 ====","round-header"),a(n,"round-header"),e.length>0?a(`我方剩余手牌: ${e.join(" ")}`,"log-entry"):a("我方无剩余手牌","log-entry"),s.length>0?a(`敌方剩余手牌: ${s.join(" ")}`,"log-entry"):a("敌方无剩余手牌","log-entry"),j.textContent=n,M.classList.add("show"),t.playerSlots=e,t.enemySlots=s,w(),P.disabled=!1}if(S.length>0){const n=S.shift();n&&n()}}function Y(e,s,l,L,n){t.animationInProgress=!0,b.innerHTML="";const o=document.createElement("div");o.className="battle-stage";const i=document.createElement("div");i.className="queue-container player-queue";const y=document.createElement("div");y.className="queue-container enemy-queue";const m=document.createElement("div");m.className="battle-area";const c=document.createElement("div");c.className="battle-hand player-hand",c.textContent=e;const d=document.createElement("div");d.className="battle-hand enemy-hand",d.textContent=s;const f=document.createElement("div");f.className="battle-effect";const C=document.createElement("div");C.className="battle-result",m.appendChild(c),m.appendChild(f),m.appendChild(d),m.appendChild(C),L.forEach((r,E)=>{const u=document.createElement("div");u.className="queue-slot player-queue-slot",u.textContent=r,E===0&&u.classList.add("current"),i.appendChild(u)}),n.forEach((r,E)=>{const u=document.createElement("div");u.className="queue-slot enemy-queue-slot",u.textContent=r,E===0&&u.classList.add("current"),y.appendChild(u)}),o.appendChild(i),o.appendChild(m),o.appendChild(y),b.appendChild(o);let h="💥",p="";l==="win"?(h="✨",p="我方获胜",c.classList.add("win"),d.classList.add("lose")):l==="lose"?(h="💥",p="敌方获胜",c.classList.add("lose"),d.classList.add("win")):(h="🔄",p="平局",c.classList.add("draw"),d.classList.add("draw")),f.textContent=h,C.textContent=p,b.classList.add("show"),setTimeout(()=>{c.classList.add("animate"),d.classList.add("animate")},100),setTimeout(()=>{c.classList.remove("animate"),d.classList.remove("animate"),c.classList.add("player-hand","animate"),d.classList.add("enemy-hand","animate")},600),setTimeout(()=>{f.classList.add("show")},1200),setTimeout(()=>{C.classList.add("show")},1500),setTimeout(()=>{if(l==="win"){const r=y.querySelector(".queue-slot.current");r&&r.classList.add("lose")}else if(l==="lose"){const r=i.querySelector(".queue-slot.current");r&&r.classList.add("lose")}else{const r=i.querySelector(".queue-slot.current"),E=y.querySelector(".queue-slot.current");r&&r.classList.add("draw"),E&&E.classList.add("draw")}},2e3),setTimeout(()=>{O(),F()},3e3)}function R(e,s){return e===s?"draw":e==="👊🏻"&&s==="✌🏻"||e==="✌🏻"&&s==="🖐🏻"||e==="🖐🏻"&&s==="👊🏻"?"win":"lose"}document.addEventListener("DOMContentLoaded",()=>{z()});
